---
name: file-cleaner
description: 文件清理器 - 自动清理无用文件，智能识别需确认的文件
metadata: { "openclaw": { "emoji": "🧹", "version": "1.0.2" } }
---

> **测试版本 v1.0.2** - 用于测试 word_update Skill
metadata: { "openclaw": { "emoji": "🧹", "requires": { "bins": ["jq", "du", "find"] } } }
---

# file-cleaner

文件清理器 - 智能清理 OpenClaw 对话记录和临时文件，释放存储空间。

## 概述

本 Skill 用于清理对话过程中产生的冗余文件，包括：
- 过期的 session 记录
- 已压缩的旧记忆文件
- 临时缓存文件
- 重复或无效数据

---

## 触发条件

**手动触发**：
- 用户说"清理文件"、"清理空间"、"清理对话"
- 用户说"整理记忆"、"压缩记忆"

---

## 清理模式

### 模式一：自动清理（无疑问）

系统会**自动清理**以下类型的文件：

| 文件类型 | 清理条件 | 说明 |
|----------|----------|------|
| 过期 session | 超过 30 天 | 旧的对话记录 |
| 临时缓存 | 任何时候 | 临时文件 |
| 重复日志 | 超过 7 天 | 重复的日志文件 |
| 压缩后的原文件 | 已有优化记忆 | 已被压缩的记忆原文件 |

**注意**：自动清理不会删除任何用户重要数据。

---

### 模式二：待确认清理

以下类型的文件**无法确定是否需要清理**，需要用户选择：

| 文件类型 | 可能价值 | 风险 |
|----------|----------|------|
| 中等年代的 session | 可能有用的历史记录 | 可能包含重要信息 |
| 未压缩的大文件 | 重要对话备份 | 不确定是否需要 |
| 优化记忆覆盖的文件 | 被压缩的原始数据 | 不确定是否还需要 |

**用户选择**：

1. **暂时保留** - 本次清理不选择该文件，下次清理时仍会询问
2. **删除** - 本次直接删除该文件
3. **以后不清理** - 永久保留该文件，后续清理不再询问

---

## 使用方法

### 1. 检查清理状态

```bash
# 查看当前存储使用情况
du -sh ~/.openclaw/agents/main/sessions/
du -sh ~/.openclaw/workspace/memory/optimized/
```

### 2. 执行清理

当用户说"清理文件"时：

**第一步：分析文件**
- 列出所有可清理的文件
- 识别自动清理的文件（无疑问）
- 识别需要确认的文件（有疑问）

**第二步：自动清理**
- 先清理无疑问的文件
- 显示清理结果

**第三步：待确认清理**
- 列出需要确认的文件
- 逐个询问用户如何处理
- 根据用户选择执行操作

---

## 配置文件

清理配置存储在 `~/.openclaw/config/cleaner.json`：

```json
{
  "autoClean": {
    "sessionRetentionDays": 30,
    "logRetentionDays": 7,
    "tempFiles": true,
    "compressedOriginal": true
  },
  "neverClean": [
    "memory/optimized/*",
    "MEMORY.md"
  ],
  "confirmClean": [
    "agents/main/sessions/*.jsonl"
  ]
}
```

---

## 清理规则

### 自动清理规则

1. **过期 session**
   - 保留最近 30 天的对话
   - 删除更早的 session 文件

2. **临时文件**
   - 清理所有 `*.tmp` 文件
   - 清理 `temp/` 目录下的文件

3. **已压缩的原文件**
   - 当存在优化记忆后，原 session 文件可清理
   - 优化记忆会保留关键信息

### 确认清理规则

1. **中等年代文件（7-30 天）**
   - 列出文件列表
   - 询问用户处理方式

2. **大文件（>1MB）**
   - 显示文件大小
   - 询问是否需要保留

---

## 交互流程

### 示例对话

```
用户: 清理文件

AI: 开始分析文件...
   
📊 当前存储状态:
- sessions/: 5.2MB (11个文件)
- memory/: 3.5MB (含优化记忆)
- logs/: 1.2MB

✅ 已自动清理:
- 过期 session: 3个文件 (释放 2.1MB)
- 临时文件: 5个文件 (释放 0.3MB)

❓ 以下文件需要确认:

1. session-2026-02-10.jsonl (800KB)
   - 日期: 2026-02-10 (6天前)
   - 操作: [保留] [删除] [以后不清理]

2. session-2026-02-12.jsonl (1.2MB)
   - 日期: 2026-02-12 (4天前)
   - 操作: [保留] [删除] [以后不清理]

请告诉我每个文件的处理方式，或说"全部保留"/"全部删除"
```

---

## 注意事项

- ✅ 自动清理只删除明确无用的文件
- ✅ 删除前会显示释放的空间大小
- ❌ 不会删除正在使用的当前对话
- ❌ 不会删除用户明确标记为重要的文件

---

## 快速命令

```bash
# 查看存储使用
du -sh ~/.openclaw/agents/main/sessions/
du -sh ~/.openclaw/workspace/memory/optimized/

# 查看 session 文件列表（按日期）
ls -lt ~/.openclaw/agents/main/sessions/*.jsonl

# 查看文件大小分布
du -h ~/.openclaw/agents/main/sessions/*.jsonl | sort -h
```
